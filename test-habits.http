### Habits Module API Tests
### ðŸ”§ MOCK Implementation - In-memory storage
###
### Before running these tests:
### 1. Start the server: npm run start:dev
### 2. Login to get access token (see test-auth.http)
### 3. Replace {{token}} with your actual JWT token

@baseUrl = http://localhost:3000/v1
@token = your-jwt-token-here

### ============================================
### Authentication (Get Token First)
### ============================================

### Login to get access token
POST {{baseUrl}}/auth/login HTTP/1.1
Content-Type: application/json

{
  "email": "admin@example.com",
  "password": "Admin123!"
}

### ============================================
### 1. Create Habits
### ============================================

### Create daily fitness habit
POST {{baseUrl}}/habits HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Morning Exercise",
  "description": "30 minutes of cardio or strength training",
  "frequency": "daily",
  "category": "fitness",
  "color": "#4CAF50",
  "targetCount": 1,
  "goalDescription": "Stay healthy and energized"
}

### Create weekly reading habit
POST {{baseUrl}}/habits HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Read for 30 minutes",
  "description": "Reading books before bed",
  "frequency": "daily",
  "category": "learning",
  "color": "#2196F3",
  "targetCount": 1,
  "goalDescription": "Read 24 books this year"
}

### Create weekly meditation habit (Mon, Wed, Fri)
POST {{baseUrl}}/habits HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Meditation",
  "description": "10 minutes of mindfulness meditation",
  "frequency": "weekly",
  "customDays": [1, 3, 5],
  "category": "mindfulness",
  "color": "#9C27B0",
  "targetCount": 1,
  "goalDescription": "Reduce stress and improve focus"
}

### Create custom habit (Tue, Thu, Sat)
POST {{baseUrl}}/habits HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Gym Workout",
  "description": "1 hour strength training session",
  "frequency": "custom",
  "customDays": [2, 4, 6],
  "category": "fitness",
  "color": "#FF5722",
  "targetCount": 1,
  "goalDescription": "Build muscle and strength"
}

### Create health habit with multiple daily completions
POST {{baseUrl}}/habits HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Drink Water",
  "description": "Stay hydrated throughout the day",
  "frequency": "daily",
  "category": "health",
  "color": "#03A9F4",
  "targetCount": 8,
  "goalDescription": "Drink 8 glasses of water per day"
}

### ============================================
### 2. Get Habits
### ============================================

### Get all habits (default pagination)
GET {{baseUrl}}/habits HTTP/1.1
Authorization: Bearer {{token}}

### Get habits with pagination
GET {{baseUrl}}/habits?page=1&limit=5 HTTP/1.1
Authorization: Bearer {{token}}

### Filter by category (fitness)
GET {{baseUrl}}/habits?category=fitness HTTP/1.1
Authorization: Bearer {{token}}

### Filter by frequency (daily)
GET {{baseUrl}}/habits?frequency=daily HTTP/1.1
Authorization: Bearer {{token}}

### Get archived habits
GET {{baseUrl}}/habits?isArchived=true HTTP/1.1
Authorization: Bearer {{token}}

### Sort by streak (descending)
GET {{baseUrl}}/habits?sortBy=currentStreak&sortOrder=desc HTTP/1.1
Authorization: Bearer {{token}}

### Sort by total completions
GET {{baseUrl}}/habits?sortBy=totalCompletions&sortOrder=desc HTTP/1.1
Authorization: Bearer {{token}}

### Get today's habits
GET {{baseUrl}}/habits/today HTTP/1.1
Authorization: Bearer {{token}}

### Get single habit by ID
GET {{baseUrl}}/habits/1 HTTP/1.1
Authorization: Bearer {{token}}

### ============================================
### 3. Update Habits
### ============================================

### Update habit name and description
PATCH {{baseUrl}}/habits/1 HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Morning Exercise - Updated",
  "description": "45 minutes of mixed cardio and weights"
}

### Update habit frequency
PATCH {{baseUrl}}/habits/2 HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "frequency": "weekly",
  "customDays": [0, 1, 2, 3, 4, 5, 6]
}

### Update habit color
PATCH {{baseUrl}}/habits/1 HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "color": "#FF9800"
}

### Archive habit
PATCH {{baseUrl}}/habits/3 HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "isArchived": true
}

### Unarchive habit
PATCH {{baseUrl}}/habits/3 HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "isArchived": false
}

### ============================================
### 4. Mark Completions
### ============================================

### Mark habit as completed for today
POST {{baseUrl}}/habits/1/complete HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "date": "2024-01-15",
  "completed": true,
  "completionCount": 1,
  "notes": "Great workout this morning!"
}

### Mark habit with multiple completions
POST {{baseUrl}}/habits/5/complete HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "date": "2024-01-15",
  "completed": true,
  "completionCount": 6,
  "notes": "Drank 6 glasses so far"
}

### Mark habit as not completed (uncheck)
POST {{baseUrl}}/habits/2/complete HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "date": "2024-01-15",
  "completed": false
}

### Mark completion for past date
POST {{baseUrl}}/habits/1/complete HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "date": "2024-01-14",
  "completed": true,
  "completionCount": 1,
  "notes": "Yesterday's workout"
}

### Unmark completion for a specific date
DELETE {{baseUrl}}/habits/1/complete/2024-01-14 HTTP/1.1
Authorization: Bearer {{token}}

### ============================================
### 5. Statistics & Analytics
### ============================================

### Get habit statistics
GET {{baseUrl}}/habits/1/stats HTTP/1.1
Authorization: Bearer {{token}}

### Get month view (calendar)
GET {{baseUrl}}/habits/calendar/2024/1 HTTP/1.1
Authorization: Bearer {{token}}

### ============================================
### 6. Delete & Restore
### ============================================

### Soft delete habit
DELETE {{baseUrl}}/habits/3 HTTP/1.1
Authorization: Bearer {{token}}

### Restore deleted habit
POST {{baseUrl}}/habits/3/restore HTTP/1.1
Authorization: Bearer {{token}}

### ============================================
### 7. Debug Endpoints (Development Only)
### ============================================

### Get all mock habits (for debugging)
GET {{baseUrl}}/habits/debug/all HTTP/1.1
Authorization: Bearer {{token}}

### ============================================
### Error Cases
### ============================================

### Try to create habit without required fields
POST {{baseUrl}}/habits HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Test"
}

### Try to create weekly habit without customDays
POST {{baseUrl}}/habits HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Invalid Weekly Habit",
  "frequency": "weekly",
  "category": "other"
}

### Try to get non-existent habit
GET {{baseUrl}}/habits/999 HTTP/1.1
Authorization: Bearer {{token}}

### Try to mark completion with invalid date
POST {{baseUrl}}/habits/1/complete HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "date": "invalid-date",
  "completed": true
}

### Try to access without authentication
GET {{baseUrl}}/habits HTTP/1.1

### ============================================
### Integration Tests
### ============================================

### Create habit, mark as complete, check stats
# 1. Create habit
POST {{baseUrl}}/habits HTTP/1.1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Test Habit",
  "frequency": "daily",
  "category": "productivity"
}

# 2. Mark as complete
# POST {{baseUrl}}/habits/{id-from-step-1}/complete
# { "date": "2024-01-15", "completed": true }

# 3. Check statistics
# GET {{baseUrl}}/habits/{id-from-step-1}/stats
